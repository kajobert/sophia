

#!/bin/sh
echo "ğŸ›‘ Zastavuji SOPHII..."

# Vzory procesÅ¯, kterÃ© chceme ukonÄit
PATTERNS="python.*run.py python.*autonomous_main.py python.*autonomous_worker_with_dashboard.py"

STOPPED_ANY=0
for PATTERN in $PATTERNS; do
    for PID in $(pgrep -f "$PATTERN"); do
        OWNER=$(ps -o user= -p $PID 2>/dev/null | awk 'NR==2{print $1}')
        if [ "$OWNER" = "root" ] && [ "$(id -u)" -ne 0 ]; then
            echo "âš ï¸  Proces $PID bÄ›Å¾Ã­ jako root. SpusÅ¥te tento skript s 'sudo' pro ÃºplnÃ© ukonÄenÃ­."
        else
            kill $PID 2>/dev/null
            sleep 1
            if kill -0 $PID 2>/dev/null; then
                echo "â³ Proces $PID stÃ¡le bÄ›Å¾Ã­, posÃ­lÃ¡m SIGKILL..."
                kill -9 $PID 2>/dev/null
            fi
            if ! kill -0 $PID 2>/dev/null; then
                echo "âœ… Proces $PID ukonÄen."
                STOPPED_ANY=1
            else
                echo "âŒ NepodaÅ™ilo se ukonÄit proces $PID."
            fi
        fi
    done
done

if [ $STOPPED_ANY -eq 1 ]; then
    echo "âœ… SOPHIA procesy ukonÄeny."
else
    echo "â„¹ï¸  SOPHIA procesy nebyly nalezeny nebo jiÅ¾ nebÄ›Å¾Ã­."
fi
